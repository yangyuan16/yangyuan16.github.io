---
layout: post 
title:  Notes for reading paper "Machine Learning in Chinese Stock Market" 
description:    
tag: reading notes of financial studying
---

### Abstract
> Notes for reading paper [Machine Learning in Chinese Stock Market](https://doi.org/10.1016/j.jfineco.2021.08.017)

### Main results
> (1) Neutral networks robustly outperform other methods in terms of 
>out-of-sample R^2
>
> (2) The out-of-sample R^2 are particularly large for the subsamples 
>of <font color=red>small firms</font> and non-state-owned firms. Hence,
>predictability is more significant for those subsamples of stocks in which <font color=red>retail traders</font> plays a much bigger role.
>
>(3) Comparing the out-of-sample R^2 with studies in the U.S. market, 
>the Chinese market reveals substantially more predictability. 
>
>(4) out-of-sample predictability.
>
>(5) unconditional and conditional predictive ability test.
>
>(6) explores whether predictability translates into portfolio gains.
>

### other results
> We also find that predictability of SOEs (国有企业) in terms of out-of-sample predictive R^2 
> is <font color=red>weaker</font> than for <font color=red>non-SOEs</font> at 
>a <font color=red>monthly prediction horizon</font>, which confirms the SOE's reputation of 
>being <font color=red>non-transparent</font> (国企的声誉并不透明). 
>
>Our results indicate that also that a long-only portfolio can provide substantial and, 
>even after including transaction costs, economically signicant performance
> (我们的结果还表明，一个只做多的投资组合可以提供实质性的、甚至包括交易成本在内的经济显著的业绩 )



### Methods and Data
#### Methods
* (1) Apply the empirical design of Gu et al. (2020b) to the Chinese market.

* (2) linear models:
> ordinary least squares regression (OLS)
>
> partial least squares (PLS)
>
> least absolute shrinkage and selection operator (LASSO)
>
> elastic net (Enet) 
>
> gradient boosted regression trees (GBRT)
>
> random forest (RF)
>
> variable subsample aggregation (VASA)
>
> neutral networks with only 5 layers (NN1 - NN5)

#### Data
* (1) WIND

* (2) CSMAR

* (3) Predictors: [Green et al. 2017](https://doi.org/10.1093/rfs/hhx019).
The characteristic that provide independent information about average US monthly stock return.
A large collection of stock-level predictive characteristic based on the variable definitions in
the original literature listed in [Green et al. 2017](https://doi.org/10.1093/rfs/hhx019), 
and the literature on China-specific factors. 

#### Data process
* (1) classify predictors
> 90 * 1 vector of stock-level characteristics, 11 * 1 vector of macroeconomic predictors,
> 80 * 1 vector of dummy variables


* (2) interaction term between two groups of predictors
> Using <font color=red>Kronecker product</font> (直乘) to represent the interaction terms 
> between stock-level characteristics and the eleven macroeconomic predictors:
> ![](http://yangyuan16.github.io//images/posts/Quantitative_analysis/kron_predictors.jpg)
> We first explore the variable importance of 11 macroeconomic variables and  
> 94 stock characteristics for all prediction models based on the Chinese stock market.
> The variable improtance is defined similarly as in [Gu et al. (2020b)](https://doi.org/10.1093/rfs/hhaa009).



### Empirical analysis

* We start exploring our models' prediction performance via out-of-sample 
predictive $$R^2$$ and discuss predictability across different subsamples of our data.

* Table1:
> ![](http://yangyuan16.github.io//images/posts/Quantitative_analysis/ML_ch_table1.jpg) 
> * 将样本进行 SOEs 和 non-SOEs 分类的原因：
 As state-owned enterprises (SOEs) play an prominent in China's capital markets and are
 often criticized for information transparency, we explore the R^2 for both SOEs and 
 non-SOEs. 
> * 将样本进行 70% - 30% 分割的原因：[As Liu et al. (2019)](https://doi.org/10.1016/j.jfineco.2019.03.008) 
 argue, the samllest 30% of firms often serve as potential shells in reverse 
mergers that circumvent tight IPO constraints. (正如Liu等人（2019年）所说，最小的30%的公司通常是潜在
的规避严格IPO约束的反向合并中的空壳 ) At the same time, Chinese retail investors have a
 notorious preference for investing in small stocks, in particular growth and 
 glamour stocks.(与此同时，中国散户投资者对小型股的投资偏好很强，尤其是增长型和魅力型股票 ) 
> * 将样本按 market capitalization per shareholder 分割的原因：To shed light on 
the connection between predictability and retail investors, we further conduct
subgroup analysis based on the average market capitalization per shareholder.
At last, we investigate model predictability by looking into the out-of-sample
R^2 for thses two groups. 
> * OLS model: OLS model achieves a positive R^2 of 0.81%, showing even the simplest model
 still has some predictive power. The R^2 for OLS-3 is slightly lower than that for OLS
 (0.77% v.s. 0.81%), indicating the three covariates alone (size, book-to-market, and
 momentum) are insufficient to account for all predictive power in linear models. <font color=red>It is 
 noteworthy that the OLS model performs much better in China's stock market than 
 in the U.S. stock market </font> 
> * For PLS, LASSO, and Enet, <font color=red> the improvement of the R^2 directly
 reflect the effectiveness of dimension reduction when we are faced with 
 a large set of covariates </font>. (对于 PLS, LASSO, Enet, R^2 的提升反映了面对大量协变量
 时降维的有效性。)
> * 因此，R2的这种提升表明，一些股票特征对于预测中国股市的月度回报是多余的，
 这与[顾等人（2020b）](https://doi.org/10.1093/rfs/hhaa009) 对美国市场的研究结果很好地吻合. 
> * 树模型、GBRT和RF以及五个神经网络模型都对 R^2 有所改进,
在所有七种型号中甚至进一步达到2%以上。
这种改进证明了机器学习方法在捕捉预测<font color=red>因子之间复杂交互方面的优势</font>，[Gu等人（2020b）](https://doi.org/10.1093/rfs/hhaa009) 也强调了这一点。
> * The results in Table 1 suggest that all models have a much better predictive performance
for small stocks. The linear models, the linear models, OLS and OLS-3, now
raise their R^2 to above 1%, while the regularized linear model, including PLS, 
LASSO, and Enet, nearly double their performance.
> * 负的 R^2: Interestingly, OLS, RF, and even GBRT, now have negative R^2, indicating
they are easily dominated by <font color=red>a naive forecast of zero returns</font>
for all stocks in all periods.

<br/>

* Table2:
> ![](http://yangyuan16.github.io//images/posts/Quantitative_analysis/ML_ch_table2.jpg)
> * 表明机器学习方法可以在更长的时间内成功地隔离持续风险溢价: We find that the annual
out-of-sample R^2 are higher than their monthly counterparts, indicating machine learning
methods can successfully isolate persistent risk premiums at longer horizons.  
> *我们将短期可预测性（尤其是小型股）归因于散户投资者在中国股市中的突出作用。
正如我们稍后将看到的，在较短的视野内，神经网络更加重视小盘股的波动性和动量相关变量，
这可能反映了散户投资者的短期投机行为，以及他们的知名度也就是喜欢优先交易小型股 

<br/>

* Table4:
> Given the large number of predictors, we next investigate whether certain predictors are more important than others. 
To this end, we differentiate between the macroeconomic variables and the stock characteristics.
>(鉴于预测因素数量众多，我们接下来研究<font color=red>某些预测因素是否比其他预测因素更重要</font>。
>为此，我们区分了宏观经济变量和股票特征。)
> ![](http://yangyuan16.github.io//images/posts/Quantitative_analysis/ML_ch_table4.jpg)
> * Table 4 reports the relative variable importance of our 11 <font color=red> macroeconomic variables </font>
> * For PLS, ntis, which measure the level of <font color=red>issuance activity</font>, has the largest 
variable importance. (对于 PLS, ntis 拥有最大的 variable importance)
> * China has been adopting an approval-based IPO system ever since its stock market opened, and it is wellknown 
that the China Securities Regulatory Commission often suspends or reduces the volume of  IPOs when the market is 
down, making it reasonable for ntis to play an important role in predicting monthly returns.  (中国自股票市场开放以来一直采用基于批准的IPO制度，
众所周知，<font color=red>中国证监会经常在市场下跌时暂停或减少IPO数量</font>，这使得NTI在预测月度回报方面发挥重要作用是合理的。 )
>* 值得注意的是 ntis 是 GBRT 最重要的 macroeconomic variable 同时也是 neural networks 第二重要的 variable.
>* <font> 如何证明树模型能够检验出 predictors 之间复杂的非线性相互作用 </font> 
(The distribution 
of macroeconomic variable importance for tree models GBRT and RF is relatively more 
uniform than other regression-based methods, indicating these two methods can detect 
potentially complicated nonlinear interactions between macroeconomic variables and 
stock characteristics) 与其他基于回归的方法相比，<font color=red>树模型GBRT和RF的宏观经济变量重要性
分布相对更加均匀</font>，表明这两种方法可以检测宏观经济变量和股票特征之间潜在的<font color=red>复杂非线性相互作用</font>.

<br/>
 
* Figure 1:
> ![](http://yangyuan16.github.io//images/posts/Quantitative_analysis/ML_ch_figure1.jpg)
> * 图1汇总了每个宏观经济变量的模型变量重要性。总体而言，我们发现<font color=red>infl和NTI是预测中国股市月收益率的两个最常用的宏观经济变量</font>，
尤其是神经网络。另一方面，股息价格比（dp）、市场波动率（svar）、每股总收益（ep）、期限利差（tms）和市场流动性（mtr）不太重要，
因为大多数模型都忽略了它们。 

<br/>
 
* Figure 2:
>![](http://yangyuan16.github.io//images/posts/Quantitative_analysis/ML_ch_figure2.jpg)
> * 关于整体变量重要性的排序，发现，在预测中国股市时，<font color=red>与市场流动性相关的股票特征最为相关</font>，
即流动性波动性（std-dolvol和std-turn）、零交易日（zerotrade）和非流动性测度（ill）是最显著的预测因子。 
> * 第二个有影响力的群体包含<font color=red>基本面信号和估值比率</font>，如行业调整后的资产周转率变化（chaotia）、
行业调整后员工变化（chempia）、总市值（mve）、近期收入增长数、nincr、行业调整后利润率变化（chpmia）
和行业调整后账面市值变化（bm_ia）。  
> * 第三组由<font color=red>风险度量</font>组成，包括特殊回报波动率（INDIVOL）、总回报波动率和市场贝塔（beta）。
我们的研究结果与 [Gu等人（2020b）](https://doi.org/10.1093/rfs/hhaa009) 在美国市场的研究结果进行了鲜明的对比和差异。
他们发现，<font color=red>传统的价格趋势指标是最具影响力的预测指标</font>，对中国股市来说，
除了最近的<font color=red>最大回报（maxret）外</font>，其他指标的重要性都较低。 
> * 有趣的是，<font color=red>异常周转率( abnormal turnover ratio)（atr）</font> 也是机器学习模型中的一个影响因素（
在总体变量重要性方面排名第三），这是 [Pan等人（2015）](https://doi.org/10.1093/rof/rfv059) 最初引入的一个中国特殊因素，
用于捕捉普遍<font color=red>投机交易</font>的影响。 
> * 第四有影响的 predictors 是 trend factor: atr 和 ex_trend , [刘等人（2020年）](https://ssrn.com/abstract=3402038) 引入的趋势因子（er_trend）
解释了<font color=red>中国股市价格和成交量的持续趋势</font>。值得注意的是，作者最初引入了atr和er趋势，
以适应中国股市大量活跃个人投资者对经验资产定价的影响。
> * 先前的研究，如 [Pan等人（2015年）](https://doi.org/10.1093/rof/rfv059) 和 [Liu等人（2020年）](https://ssrn.com/abstract=3402038) 
已经证明了在因子模型中包含中国特有因素的重要性，而在这里，我们提供了进一步的证据，
证明这些因素在更复杂的机器学习模型中也具有相当大的解释力。
>* 从实践和理论的角度来看，我们也对 <font color = red> time variation of the variable importance</font> 更为关注
值得注意的是，特别是对于<font color=red>LASSO</font>而言，2015年前后的变量重要性似乎存在差距，这表明<font color=red>股市发生了结构性变化</font>。
众所周知，中国股市在2015年经历了戏剧性的繁荣和突然崩盘，这可能解释了这一发现 ( [Liu et al. 2016](https://ssrn.com/abstract=3402038) ).
>* 基于树的模型，包括GBRT和RF，倾向于选择比替代模型更广泛的特征集，
这也在 [Gu等人（2020b）](https://doi.org/10.1093/rfs/hhaa009) 中观察到。
>* 同样，流动性变量和基本面信号是GBRT和RF最重要的两组预测因子，但它们的变量顺序与其他模型略有不同。
>* 另一方面，<font color = red>树模型的变量重要性的时间变化相对较低</font>。在这里，
我们还观察到<font color=red>2015年前后变量重要性的差距</font>，特别是对于RF，如ill、idiovol和maxret。
> * VASA在变量重要性方面的行为与PLS非常相似，因为VASA是用线性子模型构建的，但<font color=red>变量重要性的时间变化水平较高 </font>。
> * 神经网络模型（NN1-NN5）<font color=red>倾向于支持流动性变量、基本信号、
估值比率和中国特有的因素</font>，包括异常周转率（atr）、趋势因子（er_trend）和前十大股东持股比例（top10holderrate）。
> *  与其他模型相比，<font color=red>神经网络在变量重要性方面具有更大的时间变化，
这表明它们可以检测并解释不同预测因子预测能力中的结构突变</font>。 
我们将这一发现归因于<font color=red>神经网络模型的可行性和适应性</font>，特别是当它们在大量数据的情况下经过调整和良好训练时。

<br/> 

* Table5:
> ![](http://yangyuan16.github.io//images/posts/Quantitative_analysis/ML_ch_table5.jpg)
> * 单纯的采用 <font color=red>out-of-sample R^2 </font> 作为 model selection 的基准在一些实际情况中表现的并不好。有一些模型
在 out-of-sample R^2 的结果上非常接近，但是 very different performance in reality.
这里我们可以采用 Conditional Superior Predictive Ability (CSPA) 来作为比较不同机器学习模型表现的指标。
这一方法是 [Li, Liao and Quaedvlieg](http://dx.doi.org/10.2139/ssrn.3536461) 发展的。
> * The USPA test indicates that the naive OLS model and the modi
ed OLS-3 model perform poorly, having the largest total number of <font color=red>rejections</font> (USPA
测试表明，naive OLS模型和修改后的OLS-3模型表现不佳，<font color= red >rejection 总数最大</font>) 
> * The GBRT, RF, NN3, NN4, and NN5 have uniformly better unconditional prediction 
performance than their alternatives, but the <font color=red>USPA test fails to differentiate their performance</font>.
(GBRT、RF、NN3、NN4和NN5的无条件预测性能均优于其替代方案，<font color=red>但USPA测试未能区分其performance</font>)。
> * 观察比对 CSAP 的测试结果，CSPA测试使我们能够更全面地区分VASA、NN2和正则化线性模型的预测性能，提供统计证据表明这些模型不如NN4和NN5。

<br/>

* Figure3
> Dissecting the <font color=red>predictability performance</font> of NN4 (剖析<font color=red>NN4</font>的可预测性性能 ).
> ![](http://yangyuan16.github.io//images/posts/Quantitative_analysis/ML_ch_figure3.jpg)
> *  Table1 - Table5 以及 Fig.1 - Fig.2 的结果表明，神经网络的predictability performance似乎优于其他模型
这些算法一个经常提到的缺点就是缺乏可解释性。然而，作为一种理智检查，并提供一些关于哪些变量导致了 
considerable predictability, 对可预测性的驱动因素进行深入的挖掘。
为此，我们关注 NN4 模型 得到的 R^2_oos 值 在 samll stocks 和 large stocks 的 月度和年度的差异。
> * Panel A, 纵轴表示： moving from the top 70% to the bottom 30% stocks for the monthly strategy
绿色表示：moving 之后重要性增加，红色表示 moving 之后重要性减弱。
> * Panel A, 使用NN4 的到 20 个最重要变量的差异 （使用 NN4 预测每月范围内前70% 和后 30% 的股票）。 
> * Panel A, 当我们从大型股票转向小型股票时，三个最重要的predictor不会改变其重要性顺序: (1) _chempia_
(2) _std_dolvol_ (3) _atr_ 。 当进入到 annual horizon, 这三个 predictors 的重要性会下降 （正如 Panel B 所示）。
> * Panel A, for small stocks, while fundamental variables like cash, nincr, bm_ia, and orgcap obtain less weight.
(zerotrade和std_turnorver等<font color=red>流动性相关</font>predictor对small stocks 的权重更大，
而cash、nincr、bm_ia和orgcap等<font color=red>基本面相关变量</font>的权重对small stocks 较小) 
> * Panel A, _idiovoal_ 的结果支持了有限套利理论 (theory of limited arbitrage: anomalies become stronger
for high idiosyncratic risk stocks and hence, leading to increased overall predictability)  
> * Panel A, _maxret_ 的结果也证实了我们的猜测: influence of retail investors on the price dynamics of 
small stocks must be considerable. 如果投资者对与彩票式的回报有着强烈的偏好则极端正回报在股票的截面定价中
显示出显著的可预测性 (As [Bali et al. (2011)](https://doi.org/10.1016/j.jfineco.2010.08.014) show, if there is a strong preference among investors
for assets with lottery-like payoffs, extreme positive returns exhibit significant predictability in
the <font color=red> cross-sectional pricing of stocks </font> ).  


